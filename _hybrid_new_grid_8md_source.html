<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>CombineHarvester: docs/HybridNewGrid.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CombineHarvester
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_hybrid_new_grid_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">docs/HybridNewGrid.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_hybrid_new_grid_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor"># Calculating grids of CLs values using toys</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;The following are basic instructions <span class="keywordflow">for</span> <span class="keyword">using</span> the **HybridNewGrid** method of `combineTool.py`. In a similar fashion to the **AsymptoticGrid** method most of the settings are  specified in a json file. An example is given in `CombinePdfs/scripts/mssm_hybrid_grid.json`:</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;```json</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;{</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  <span class="stringliteral">&quot;verbose&quot;</span> : <span class="keyword">false</span>,</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="stringliteral">&quot;opts&quot;</span> : <span class="stringliteral">&quot;--testStat=TEV --frequentist --singlePoint 1.0 --saveHybridResult --clsAcc 0 --fullBToys --fork 0&quot;</span>,</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  <span class="stringliteral">&quot;POIs&quot;</span> : [<span class="stringliteral">&quot;mA&quot;</span>, <span class="stringliteral">&quot;tanb&quot;</span>],</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="stringliteral">&quot;grids&quot;</span> : [</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    [<span class="stringliteral">&quot;580:600:20&quot;</span>, <span class="stringliteral">&quot;10:30:4&quot;</span>, <span class="stringliteral">&quot;&quot;</span>]</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  ],</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="stringliteral">&quot;toys_per_cycle&quot;</span>  : 500,</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  <span class="stringliteral">&quot;min_toys&quot;</span>        : 500,</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="stringliteral">&quot;max_toys&quot;</span>        : 5000,</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="stringliteral">&quot;signif&quot;</span>          : 3.0,</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="stringliteral">&quot;CL&quot;</span>              : 0.95,</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="stringliteral">&quot;contours&quot;</span>        : [<span class="stringliteral">&quot;obs&quot;</span>, <span class="stringliteral">&quot;exp-2&quot;</span>, <span class="stringliteral">&quot;exp-1&quot;</span>, <span class="stringliteral">&quot;exp0&quot;</span>, <span class="stringliteral">&quot;exp+1&quot;</span>, <span class="stringliteral">&quot;exp+2&quot;</span>],</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <span class="stringliteral">&quot;make_plots&quot;</span>      : <span class="keyword">false</span>,</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="stringliteral">&quot;plot_settings&quot;</span> : {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;      <span class="stringliteral">&quot;one_sided&quot;</span>     : <span class="keyword">false</span>,</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      <span class="stringliteral">&quot;model_label&quot;</span>   : <span class="stringliteral">&quot;m_{H}^{mod+}&quot;</span>,</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;      <span class="stringliteral">&quot;poi_labels&quot;</span>    : [<span class="stringliteral">&quot;m_{A}&quot;</span>, <span class="stringliteral">&quot;tan#beta&quot;</span>],</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;      <span class="stringliteral">&quot;null_label&quot;</span>    : <span class="stringliteral">&quot;SM&quot;</span>,</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;      <span class="stringliteral">&quot;alt_label&quot;</span>     : <span class="stringliteral">&quot;MSSM&quot;</span>,</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      <span class="stringliteral">&quot;cms_subtitle&quot;</span>  : <span class="stringliteral">&quot;Internal&quot;</span>,</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;      <span class="stringliteral">&quot;formats&quot;</span>       : [<span class="stringliteral">&quot;.pdf&quot;</span>, <span class="stringliteral">&quot;.png&quot;</span>]</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  },</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="stringliteral">&quot;zipfile&quot;</span>         : <span class="stringliteral">&quot;collected.zip&quot;</span>,</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="stringliteral">&quot;output&quot;</span>          : <span class="stringliteral">&quot;HybridNewGridMSSM.root&quot;</span>,</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="stringliteral">&quot;output_incomplete&quot;</span> : <span class="keyword">true</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;}</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;```</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;The `combineTool.py` method is then invoked as follows:</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;```sh</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;combineTool.py -M HybridNewGrid scripts/mssm_hybrid_grid.json --cycles [cycles] -d [workspace]</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;```</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;This method will generate the specified number of toy cycles <span class="keywordflow">for each</span> model point, where one cycle implies one run of combine with a <span class="keyword">new</span> random seed. The setting `toys_per_cycle` controls the number of background-only and signal+background toys that will be generated in each combine job. Several options are also provided which can be used concentrate the generation of toys around the relevant observed and expected exclusion contours. These specify a set of criteria which, when fulfilled, prevent the creation of any further combine jobs <span class="keywordflow">for</span> that model point. These settings are:</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; - `min_toys`: Require that at least <span class="keyword">this</span> many toys are run at each point</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; - `max_toys`: When <span class="keyword">this</span> number of toys is reached <span class="keywordflow">do</span> not run any more jobs, even <span class="keywordflow">if</span> other criteria are still not fulfilled</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; - `signif`: Require that the CLs value at each point is at least <span class="keyword">this</span> many standard deviations from the specified confidence level value (1 - CL), i.e. `abs(CLs - (1-CL)) / ClsErr &gt; signif`, where `CLsErr` is the statistical uncertainty on the CLs value. This criteria must be met <span class="keywordflow">for</span> observed and/or expected quantiles listed in `contours`. Essentially <span class="keyword">this</span> requires the probablity of the CLs value we have determined being on the wrong side of the critical CLs value to be very small.</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;The `combineTool.py` command above can be repeatedly invoked until a sufficient number of points have met the chosen criteria. At any point the TGraph2Ds of the CLs values can be produced by adding the option `--output`. To just check the progress of the points run with `--cycles 0`. It is possible to choose <span class="keywordflow">if</span> model points which have not yet met these criteria should be included in the output graphs with the option `output_incomplete`. When set to `<span class="keyword">false</span>` only the points passing the validation will be included.</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;Plots of the test statistic distributions at each model point can be created by setting the option `make_plots` to `<span class="keyword">true</span>`.</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;Due to the potentially huge number of output files expected <span class="keywordflow">for</span> large grids, and because <span class="keyword">this</span> can cause problems <span class="keywordflow">for</span> some networked file-systems, it is possible to automatically transfer the output to a single zip file and have ROOT read the files directly from <span class="keyword">this</span> archive. This is enable by setting the value of `zipfile` to any non-empty <span class="keywordtype">string</span>. Each time `combineTool.py` is invoked it will first look <span class="keywordflow">for</span> output files in the given zip file (creating it <span class="keywordflow">if</span> it doesn<span class="stringliteral">&#39;t already exist), then it will look for any other files in the local directory and append these to the zip file before deleting the local version.</span></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
</body>
</html>
