<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>CombineHarvester: docs/Main.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CombineHarvester
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_main_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">docs/Main.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_main_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Introduction {#mainpage}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;========================</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;[TOC]</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;This page documents the CombineHarvester framework for the production and analysis of datacards for use with the CMS [combine](https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit) tool. The central part of this framework is the [CombineHarvester](\ref ch::CombineHarvester) class, which provides a representation of the text-format datacards and the associated shape input.</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;The production of new datacards typically requires several steps, for example:</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  * Defining analysis categories, signal and background processes</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  * Adding systematic uncertainties</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  * Extracting the related shape inputs from ROOT files</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  * Modifying this information in-place, e.g. scaling signal processes to different cross sections, switching processes from background to signal and *vice versa*</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  * Applying bin error merging and creating bin-by-bin uncertainties</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  * Pruning the set of bin-by-bin nuisance parameters</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  * Exporting to the text datacard format and creating the associated ROOT shape files</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;All of these operations are performed either directly by methods of the CombineHarvester class, or by using higher-level helper functions (see \ref high-level-tools below). By design all of the input required for these steps can be specified directly in the code. This makes it possible to quickly build a datacard in a single, self-contained file, without the use of any external scripts or configuration files.</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;Other functions include extracting information about the fit model:</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  * Evaluating the expected rates of signal and background processes, both pre- and post-fit, and for the latter taking into account the nuisance parameter correlations</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  * Similar evaluation of the background shapes, including the ability to scale, modify and re-bin the shapes in-place</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;As well as histogram-based templates, the production of datacards with arbitrary RooFit PDFs and datasets is also supported.</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;Getting started {#getting-started}</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;==================================</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;This repository is a &quot;top-level&quot; CMSSW package, i.e. it should be located at `$CMSSW_BASE/src/CombineHarvester`. It currently provides two sub-packages:</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  * **CombineHarvester/CombineTools**, which contains the CombineHarvester class and other parts of the core framework</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  * **CombineHarvester/CombinePdfs**, which provides tools for building custom RooFit pdfs</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;The CMSSW version that should be used with CombineHarvester is driven by the recommendation for the HiggsAnalysis/CombinedLimit package, which is also required. The latest instructions can be found [here](https://cms-hcomb.gitbooks.io/combine/content/part1/#for-end-users-that-dont-need-to-commit-or-do-any-development). The CombineHarvester framework is  compatible with the CMSSW 7_4_X and 8_1_X series releases. A new release area can be set up and compiled in the following steps:</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    export SCRAM_ARCH=slc6_amd64_gcc530</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    scram project CMSSW CMSSW_8_1_0</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    cd CMSSW_8_1_0/src</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    cmsenv</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    git clone https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit.git HiggsAnalysis/CombinedLimit</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    # IMPORTANT: Checkout the recommended tag on the link above</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    git clone https://github.com/cms-analysis/CombineHarvester.git CombineHarvester</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    scram b</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;If you are using this framework for the first time we recommend taking a look through some of the examples below which demonstrate the main features:</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  * [Examples Part 1](\ref intro1): How CombineHarvester builds a datacard representation, parsing existing datacards, evaluating contents</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  * [Examples Part 2](\ref intro2): Creating a new datacard, defining processes and systematics, writing text datacards</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  * [Examples Part 3](\ref intro3): Creating a counting-experiment datacard and using rateParam directives to float process yields via free parameters while express other yields as functions of these parameters.</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  * [Limit setting](\ref limits): Using the `combineTool.py` script to build workspaces, compute asymptotic limits and plot the ouput.</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;\warning To run many of these examples you must first ensure the [auxiliaries](https://github.com/roger-wolf/HiggsAnalysis-HiggsToTauTau-auxiliaries) repository is located at `$CMSSW_BASE/src/auxiliaries` and up-to-date:</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;\verbatim</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;git clone https://github.com/roger-wolf/HiggsAnalysis-HiggsToTauTau-auxiliaries.git auxiliaries \endverbatim</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;The input root files will be sourced from here.</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;More realistic, though less well documented, examples can be found in the following files:</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  * `CombineTools/bin/PostFitShapes.cpp` ([source code](\ref CombineTools/bin/PostFitShapes.cpp)) - see separate page [here](\ref post-fit-shapes)</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  * `CombineTools/bin/SMLegacyExample.cpp` ([source code](\ref CombineTools/bin/SMLegacyExample.cpp)) - produces a complete set of htt datacards for the legacy Run I SM analysis (HIG-13-004). The same workflow is also possible in python, see `CombineTools/scripts/SMLegacyExample.py`</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  * `CombineTools/bin/MSSMYieldTable.cpp` ([source code](\ref CombineTools/bin/MSSMYieldTable.cpp)) - produces the latex yield tables for the MSSM htt analysis (HIG-13-021). Run via the script `CombineTools/scripts/yield_tables_mssm_example.sh`. You will first need to copy the input datacards: `cd CombineTools; cp -r /afs/cern.ch/work/a/agilbert/public/CombineTools/data/mssm-paper-cmb ./input/`</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;High-level tools {#high-level-tools}</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;====================================</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;A number of high-level tools have been developed to provide a more convenient interface for some common CombineHarvester tasks:</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  * ch::CardWriter: In a nutshell, calls `CombineHarvester::WriteDatacard` so you don&#39;t have to. It can be used to write a set of datacards into the familiar **LIMITS** directory structure, or any other structure based on simple pattern strings.</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  * ch::BinByBinFactory: Does the merging of bin uncertainties within a category and creates bin-by-bin shape systematics</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  * CopyTools.h: Provides functions like ch::CloneProcsAndSysts and ch::SplitSyst for duplicating existing processes and systematics</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  * ch::ParseCombineWorkspace: A function that can populate a CombineHarvester instance directly from a `combine` workspace. May be useful for extracting post-fit yields and shapes for more complex physics models. Should be considered experimental at the moment.</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;Other comments {#note}</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;======================</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;**Creating a new package**: It is planned that each new analysis will create their own package within the `CombineHarvester` directory, where all the datacard creation, plotting and other tools specific to the analysis will be stored. This keeps the analysis-specific code self-contained, and ensures different analyses do not disrupt each other&#39;s workflow during the development phase. We expect that some tools or functions developed for specific analyses will be of more general use, in which case they will be promoted to the common `CombineTools` package. **Please raise an issue [here](https://github.com/cms-analysis/CombineHarvester/issues/new) if you would like a new package to be created for your analysis.**</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;**Code developments**: New features and developments, or even just suggestions, are always welcome - either contact the developers directly or make a pull request.</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;**Python interface**: A python interface is also available - see the documentation page [here](\ref python-interface) for usage instructions. This is ultimately just a wrapper around the C++ code and most functions can be called in python in exactly the same way as their C++ counterparts. There are some functions however, especially those using template arguments, which have been adapted for python usage and may not provide exactly the same interface. Furthermore, as each C++ function has to be wrapped by hand, the python interface may occasionally lag behind the C++ one.</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;**Error handling**: It is quite possible to do things in a CombineHarvester instance that don&#39;t make sense, or at least don&#39;t allow for the production of a valid datacard - for example objects with missing shape information, negative process yields and categories without either observed data or background processes. The framework has been designed to detect many of these issues at the point in which they become a problem for a given function to proceed as intended. However there is no guarantee that all such issues will be detected. If a problem is encountered, a runtime exception will be thrown indicated the nature of the problem, for example, trying to extract a histogram missing from the input root file will produce this message:</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    terminate called after throwing an instance of &#39;std::runtime_error&#39;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      what():</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    *******************************************************************************</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    Context: Function ch::GetClonedTH1 at</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      CombineHarvester/CombineTools/src/TFileIO.cc:21</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    Problem: TH1 eleTau_0jet_medium/ggH not found in CMSSW_7_1_5/src/auxiliaries/shapes/htt_et.inputs-sm-7TeV-hcg.root</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    *******************************************************************************</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;If the cause of such an error message is unclear, or if you believe the error message should not have been produced, please raise an issue here with full details on reproducing the problem: https://github.com/cms-analysis/CombineHarvester/issues/new</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;Please also raise an issue if you encounter any bugs, unintended behaviour, abrupt errors or segmentation faults - these will be addressed promptly by the developers.</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
</body>
</html>
